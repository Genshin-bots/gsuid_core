# gsuid_core Docker Compose 配置
# 部署方式: 本地构建 (挂载模式)

services:
  gsuid_core:
    build:
      context: .
      target: ${GSCORE_BUILD_TARGET:-runtime}
      args:
        - GSCORE_BASE_IMAGE=${GSCORE_BASE_IMAGE:-docker.cnb.cool/gscore-mirror/docker-sync/astral-uv:python3.12-bookworm-slim}
        - GSCORE_PYTHON_INDEX=${GSCORE_PYTHON_INDEX:-https://pypi.org/simple}

    image: gsuid-core:${GSCORE_BUILD_TARGET:-runtime}
    container_name: gsuid_core
    ports:
      - "${PORT:-8765}:8765"
    volumes:
      - ${MOUNT_PATH:-.}:/gsuid_core
      - venv-data:/venv
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - PYTHONUNBUFFERED=1
      - UV_INDEX=${GSCORE_PYTHON_INDEX:-}
      - UV_NO_CONFIG=${UV_NO_CONFIG:-}
      - http_proxy=${GSCORE_HTTP_PROXY:-}
      - https_proxy=${GSCORE_HTTPS_PROXY:-}
      - no_proxy=${GSCORE_NO_PROXY:-localhost,127.0.0.1,.local,cnb.cool,mirrors.aliyun.com,pypi.tuna.tsinghua.edu.cn,mirrors.volces.com}

volumes:
  venv-data:
